<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>RongChain 首页（v1.31）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; padding: 18px; margin: 0; background: #f5f5f5; }
    .ver { position: fixed; right: 12px; top: 10px; color:#999; font-size:12px;}
    .topver { font-size:12px; color:#666; margin-bottom:8px;}
    h1 { margin: 8px 0 16px; }
    .content { padding-bottom: 140px; }
    .box { margin: 14px 0; padding: 14px; border: 1px solid #ddd; border-radius: 8px; background: #fff; }
    .label { font-weight: bold; margin-bottom: 6px; }
    .admin-box { margin: 14px 0; padding: 14px; border: 2px solid #007bff; border-radius: 8px; background: #e9f3ff; display: none; }
    .admin-box button { padding: 10px 15px; font-size: 14px; cursor: pointer; background: #007bff; color: #fff; border: none; border-radius: 6px; }
    .navbar { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; display: flex; justify-content: space-around; align-items: center; background: #f1f1f1; border-top: 1px solid #ccc; }
    .nav-item { text-align: center; flex: 1; font-size: 14px; cursor: pointer; color: #333; }
    .nav-item:hover { color: #007bff; }
    iframe { width: 100%; height: 420px; border: none; margin-top: 8px; border-radius:8px; }
    .muted { color:#777; font-size: 12px; }
  </style>
</head>
<body>
  <div class="ver">v1.31</div>
  <div class="topver">最高版本：v1.31</div>
  <div class="content">
    <h1>RongChain 首页</h1>
    <div id="wallet" class="muted">钱包地址: 检测中...</div>

    <div class="box">
      <div class="label">地址检测状态</div>
      <div id="addressStatus" class="muted">正在检测中...</div>
    </div>

    <div class="box">
      <div class="label">RongChain 余额</div>
      <div id="balance" class="muted">检测中...</div>
    </div>

    <div class="box">
      <div class="label">CRC 余额</div>
      <div id="crcBalance" class="muted">检测中...</div>
    </div>

    <div class="box">
      <div class="label">RongChain/USDT 价格（直链池）</div>
      <div id="price" class="muted">加载中...</div>
    </div>

    <div class="box">
      <div class="label">RongChain/CRC 价格</div>
      <div id="crcPrice" class="muted">加载中...</div>
    </div>

    <div class="box">
      <div class="label">RongChain/USDT（通过 CRC 计算）</div>
      <div id="derivedPrice" class="muted">计算中...</div>
    </div>

    <div class="admin-box" id="adminBox">
      <div class="label">管理员功能</div>
      <button onclick="goAdmin()">进入管理后台</button>
    </div>

    <div class="box">
      <div class="label">K 线行情 (示例: ETH/USDT)</div>
      <iframe src="https://s.tradingview.com/widgetembed/?symbol=BINANCE:ETHUSDT&interval=15&hidesidetoolbar=1&theme=light&style=1&timezone=Asia%2FShanghai"></iframe>
      <div class="muted">※ 若后续有 TradingView 上线你的交易对，可换成对应符号。</div>
    </div>
  </div>

  <div class="navbar">
    <div class="nav-item">首页</div>
    <div class="nav-item">拼团</div>
    <div class="nav-item">赚币</div>
    <div class="nav-item">兑换</div>
    <div class="nav-item">我的</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
    const ACCOUNT_PARAM = new URLSearchParams(window.location.search).get("account");
    const WHITELIST_CONTRACT = "0x8b32872842C76DA95aeB25d27dE2F16fa1979bE5";

    const RONGCHAIN_TOKEN = "0x0337a015467af6605c4262d9f02a3dcd8b576f7e";
    const CRC_TOKEN       = "0x5b2fe2b06e714b7bea4fd35b428077d850c48087";

    const RONGCHAIN_USDT_PAIR = "0x7f20dE20b53b8145F75F7a7Bc55CC90AEFEeb795";
    const RONGCHAIN_CRC_PAIR  = "0x8cDb69f2dDE96fB98FB5AfA6eB553eaB308D16a5";

    // ✅ 你提供的 CRC/USDT 池子地址
    const CRC_USDT_PAIR = "0x8cDb69f2dDE96fB98FB5AfA6eB553eaB308D16a5";

    const erc20Abi = [
      "function decimals() view returns (uint8)",
      "function symbol() view returns (string)",
      "function balanceOf(address) view returns (uint256)"
    ];
    const whitelistAbi = ["function owner() view returns (address)"];

    async function fetchPriceDex(pairAddr) {
      const url = "https://api.dexscreener.com/latest/dex/pairs/bsc/" + pairAddr;
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error("Dex 响应异常");
      const data = await res.json();
      if (!data || !data.pairs || data.pairs.length === 0) throw new Error("无数据");
      return data.pairs[0];
    }

    let lastCRCPrice = null;
    let lastCRC_USDT = null;

    async function updatePrices() {
      // RongChain/CRC
      try {
        const info = await fetchPriceDex(RONGCHAIN_CRC_PAIR);
        lastCRCPrice = parseFloat(info.price || info.priceNative || "0");
        document.getElementById("crcPrice").innerText = "≈ " + lastCRCPrice + " CRC";
      } catch {
        document.getElementById("crcPrice").innerText = "❌ CRC 价格失败";
      }

      // CRC/USDT
      try {
        const info = await fetchPriceDex(CRC_USDT_PAIR);
        lastCRC_USDT = parseFloat(info.priceUsd || "0");
      } catch {
        lastCRC_USDT = null;
      }

      // RongChain/USDT 直链
      try {
        const info = await fetchPriceDex(RONGCHAIN_USDT_PAIR);
        document.getElementById("price").innerText = "≈ " + info.priceUsd + " USD";
      } catch {
        document.getElementById("price").innerText = "❌ USDT 直链失败";
      }

      // 推导 RongChain/USDT
      if (lastCRCPrice && lastCRC_USDT) {
        const derived = lastCRCPrice * lastCRC_USDT;
        document.getElementById("derivedPrice").innerText = "≈ " + derived.toFixed(6) + " USD (通过 CRC)";
      } else {
        document.getElementById("derivedPrice").innerText = "❌ 推导失败";
      }
    }

    function refreshAll() {
      updatePrices();
    }

    refreshAll();
    setInterval(refreshAll, 2000);
  </script>
</body>
</html>
